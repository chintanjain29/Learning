{% schema %}
{
  "name": "Banner Slider",
  "tag": "section",
  "class": "banner-slider",
  "settings": [
    {
      "type": "range",
      "id": "slider_speed",
      "min": 3,
      "max": 10,
      "step": 1,
      "unit": "sec",
      "label": "Slider Speed",
      "default": 5
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "url",
          "id": "link",
          "label": "Slide Link"
        },
        {
          "type": "text",
          "id": "heading",
          "label": "Heading",
          "default": "Banner Heading"
        },
        {
          "type": "richtext",
          "id": "text",
          "label": "Text",
          "default": "<p>Add your banner text here</p>"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Banner Slider",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %}

{% stylesheet %}
.banner-slider {
  position: relative;
  overflow: hidden;
}
.slider-container {
  display: flex;
  transition: transform 0.5s ease;
}
.slide {
  flex: 0 0 100%;
  width: 100%;
}
.slide img {
  width: 100%;
  height: auto;
  display: block;
}
.slide-content {
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  text-align: center;
  color: #fff;
}
.pagination {
  position: absolute;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  display: flex;
  gap: 10px;
}
.pagination-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  border: 2px solid #fff;
  background-color: transparent;
  cursor: pointer;
  transition: background-color 0.3s ease;
}
.pagination-dot.active {
  background-color: #fff;
}
{% endstylesheet %}

{% javascript %}
document.addEventListener('DOMContentLoaded', function() {
  var sliderContainer = document.querySelector('.slider-container');
  var slides = document.querySelectorAll('.slide');
  var dots = document.querySelectorAll('.pagination-dot');
  var currentSlide = 0;
  var sliderSpeed = {{ section.settings.slider_speed | times: 1000 }};
  var timer;

  function showSlide(n) {
    currentSlide = (n + slides.length) % slides.length;
    sliderContainer.style.transform = `translateX(-${currentSlide * 100}%)`;
    dots.forEach((dot, index) => {
      dot.classList.toggle('active', index === currentSlide);
    });
  }

  function nextSlide() {
    showSlide(currentSlide + 1);
    startTimer();
  }

  function startTimer() {
    if (timer) {
      clearTimeout(timer);
    }
    timer = setTimeout(nextSlide, sliderSpeed);
  }

  dots.forEach((dot, index) => {
    dot.addEventListener('click', () => {
      showSlide(index);
      startTimer();
    });
  });

  startTimer();
});
{% endjavascript %}

<div class="banner-slider">
  <div class="slider-container">
    {% for block in section.blocks %}
      {% if block.type == 'slide' %}
        <div class="slide">
          {% if block.settings.link != blank %}
            <a href="{{ block.settings.link }}">
          {% endif %}
          {% if block.settings.image != blank %}
            {{ block.settings.image | image_url: width: 1500 | image_tag: loading: 'lazy', alt: block.settings.heading }}
          {% endif %}
          {% if block.settings.link != blank %}
            </a>
          {% endif %}
        </div>
      {% endif %}
    {% endfor %}
  </div>
  
  <div class="pagination">
    {% for block in section.blocks %}
      {% if block.type == 'slide' %}
        <div class="pagination-dot{% if forloop.first %} active{% endif %}"></div>
      {% endif %}
    {% endfor %}
  </div>
</div>